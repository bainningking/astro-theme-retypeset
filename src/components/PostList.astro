---
import type { CollectionEntry } from 'astro:content'
import PinIcon from '@/assets/icons/pin-icon.svg'
import PostDate from '@/components/PostDate.astro'
import { getPostPath } from '@/i18n/path'
import { getPostDescription } from '@/utils/description'
import { isHomePage } from '@/utils/page'

type Post = CollectionEntry<'posts'> & {
  remarkPluginFrontmatter: {
    minutes: number
  }
}

const { posts, lang, pinned = false, showTitle = false } = Astro.props
const isHome = isHomePage(Astro.url.pathname)

// 按更新时间逆序排序，如果没有更新时间则使用发布时间
const sortedPosts = [...posts].sort((a, b) => {
  const dateA = a.data.updated || a.data.published
  const dateB = b.data.updated || b.data.published
  return new Date(dateB).getTime() - new Date(dateA).getTime()
})

export interface Props {
  posts: Post[]
  lang: string
  pinned?: boolean
  showTitle?: boolean
}
---

{isHome && showTitle && (
  <div class="mb-8">
    <h2 class="text-5xl font-bold mb-6">Articles</h2>
  </div>
)}

<div class="article-list">
  {sortedPosts.map((post) => {
    const slug = post.data.abbrlink || post.id
    const updateDate = post.data.updated || post.data.published
    const firstTag = post.data.tags && post.data.tags.length > 0 ? post.data.tags[0] : ''

    return (
      <div class="article-item mb-4 flex items-center">
        <div class="article-date text-sm mr-4 min-w-24">
          <PostDate
            date={new Date(updateDate)}
            minutes={0}
          />
        </div>
        <div class="article-tag text-sm mr-4 min-w-16">
          {firstTag}
        </div>
        <div class="article-title">
          <a
            class="highlight-hover transition-[colors,font-weight] after:bottom-0.7em hover:(c-primary font-bold)"
            href={getPostPath(slug, lang)}
            transition:name={`post-${slug}${lang ? `-${lang}` : ''}`}
            data-disable-theme-transition
          >
            《{post.data.title}》
          </a>
        </div>
      </div>
    )
  })}
</div>

<style>
  .article-list {
    @apply ml-4;
  }
  
  .article-item {
    @apply border-l border-gray-300 pl-4;
  }
  
  .article-date {
    @apply text-gray-600;
  }
  
  .article-tag {
    @apply text-gray-500;
  }
</style>
